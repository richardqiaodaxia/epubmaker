<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Key-Value Coding</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="sect1" title="Key-Value Coding"><div class="titlepage"><div><div><h1 class="title"><a id="objectcpr-CHP-1-SECT-14"/>Key-Value Coding</h1></div></div></div><p>Objective-C <a id="objectcpr-IDXTERM-712" class="indexterm"/> <a id="objectcpr-IDXTERM-713" class="indexterm"/>lets <a id="objectcpr-IDXTERM-714" class="indexterm"/>you call methods specified by variables at runtime using
      the selector mechanism. Key-value coding is a library facility that puts
      field access on the same dynamic footing: you can access an object's
      fields by naming them. For example, you could use the following code to
      retrieve the <code class="literal">parent</code> field of a window
      object:</p><a id="I_1_tt152"/><pre class="programlisting">Window*<em class="replaceable"><code>parentWind</code></em> = [<em class="replaceable"><code>wind</code></em> valueForKey:@"parent"];</pre><p>Because you can pass a string variable to <code class="literal">-valueForKey</code> <a id="IXT-1-509" class="indexterm"/>: as well as a literal value, this is another way your
      program's behavior can vary based on values that aren't known until
      runtime.</p><p><code class="literal">NSObject</code> implements <code class="literal">-valueForKey</code>: method as part of the <code class="literal">NSKeyValueCoding</code> <a id="IXT-1-510" class="indexterm"/> category, which declares methods for reading from and
      writing to the fields of objects. These methods store and retrieve
      Objective-C objects, so their primary use is in accessing objects.
      However, even if your fields are integers or other numeric types, you
      can still use key-value coding to retrieve and set them. The methods
      will take <code class="literal">NSNumber</code> objects and
      automatically convert them to set numeric fields, and return <code class="literal">NSNumber</code> objects when you read numeric
      fields.</p><div class="sect2" title="Access Permissions"><div class="titlepage"><div><div><h2 class="title"><a id="objectcpr-CHP-1-SECT-14.1"/>Access Permissions</h2></div></div></div><p>The <a id="IXT-1-511" class="indexterm"/>key-value methods can bypass the access modifiers of the
        static language: you can read and write to <a id="IXT-1-512" class="indexterm"/>private fields as easily as to public ones. This might
        seem like a violation of the object's declared interface. However, you
        can prevent key-value methods from bypassing your access modifiers by
        overriding <code class="literal">+accessInstanceVariablesDirectly</code> <a id="IXT-1-513" class="indexterm"/> to return <strong class="userinput"><code>NO</code></strong>.</p><p>In addition, the key-value methods first search for an
        appropriate accessor method in your class before attempting to read
        from or write to a field directly. For example, the methods that read
        a field named <code class="literal">field</code> will look for
        accessor methods with the following names (the order will vary as
        described in the next section):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">getField</code></p></li><li class="listitem"><p><code class="literal">field</code></p></li><li class="listitem"><p><code class="literal">_getField</code></p></li><li class="listitem"><p><code class="literal">_field</code></p></li></ul></div><p>The key-value methods will take care of uppercasing the first
        letter of the field name before prepending <code class="literal">get</code> or <code class="literal">set</code>.</p><div class="note" title="Note"><h3 class="title"><a id="ch01-30-fm2xml"/>Note</h3><p>Although the key-value methods will search for methods or
          fields whose names start with an underscore, Apple has reserved
          these names for its internal use. Your classes should not have
          methods or fields that start with an underscore.</p></div><p>If your class provides accessor methods with the appropriate
        names, they will be called even if they are private methods not
        declared in your class's interface.</p></div><div class="sect2" title="NSKeyValueCoding Methods"><div class="titlepage"><div><div><h2 class="title"><a id="objectcpr-CHP-1-SECT-14.2"/>NSKeyValueCoding Methods</h2></div></div></div><p>The <code class="literal">NSKeyValueCoding</code>
        <a id="objectcpr-IDXTERM-720" class="indexterm"/> protocol declares (and <code class="literal">NSObject</code> implements) six methods that let
        your objects use key-value coding:</p><div class="variablelist"><dl><dt><span class="term"><code class="code"><a id="I_1_tt153"/>-(<strong class="userinput"><code>id</code></strong>)valueForKey:(NSString*)<em class="replaceable"><code>key</code></em>
            </code></span></dt><dd><p><a id="IXT-1-514" class="indexterm"/>Given the name of a field, returns the value
              stored in that field. If <em class="replaceable"><code>key</code></em> is
              <code class="literal">"field"</code>, <code class="literal">-valueForKey</code>: tries the following ways
              to get the associated value:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Calls <code class="literal">-getField</code>, if
                  it exists.</p></li><li class="listitem"><p>Calls <code class="literal">-field</code>, if it
                  exists.</p></li><li class="listitem"><p>Calls <code class="literal">-_getField</code>,
                  if it exists.</p></li><li class="listitem"><p>Calls <code class="literal">-_field</code>, if
                  it exists.</p></li><li class="listitem"><p>Reads <code class="literal">field</code>, if it
                  exists and direct access is allowed.</p></li><li class="listitem"><p>Reads <code class="literal">_field</code>, if it
                  exists and direct access is allowed.</p></li></ol></div><p>If all of these fail, <code class="literal">-valueForKey</code>: calls <code class="literal">-handleQueryWithUnboundKey</code>: on your
              object.</p></dd><dt><span class="term"><code class="code"><a id="I_1_tt154"/>-(<strong class="userinput"><code>void</code></strong>)takeValue:(<strong class="userinput"><code>id</code></strong>)<em class="replaceable"><code>value</code></em>
            forKey:(NSString*)<em class="replaceable"><code>key</code></em> </code></span></dt><dd><p><a id="IXT-1-515" class="indexterm"/>Given the (pointer to the) object, this method
              stores the pointer to the object in the field of the receiver
              named by the key. If <em class="replaceable"><code>key</code></em> is <code class="literal">"field"</code>, <code class="literal">-takeValue:forKey</code>: tries the following
              ways to set the associated value:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Calls <code class="literal">-setField</code>:,
                  if it exists.</p></li><li class="listitem"><p>Calls <code class="literal">-_setField</code>:,
                  if it exists.</p></li><li class="listitem"><p>Sets <code class="literal">field</code>, if it
                  exists and direct access is allowed.</p></li><li class="listitem"><p>Sets <code class="literal">_field</code>, if it
                  exists and direct access is allowed.</p></li></ol></div><p>If all of these fail, <code class="literal">-takeValue:forKey</code>: calls <code class="literal">-handleTakeValue:forUnboundKey</code>: on
              your instance.</p></dd><dt><span class="term"><code class="code"><a id="I_1_tt155"/>- (<strong class="userinput"><code>id</code></strong>)storedValueForKey:(NSString*)<em class="replaceable"><code>key</code></em>
            </code></span></dt><dd><p><a id="IXT-1-516" class="indexterm"/>Works like <code class="literal">-valueForKey</code>:, but with a possibly
              different search sequence:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If <code class="literal">+useStoredAccessor</code> returns
                  <strong class="userinput"><code>NO</code></strong>, the sequence is
                  the same as with <code class="literal">-valueForKey</code>:.</p></li><li class="listitem"><p>If <code class="literal">+useStoredAccessor</code> returns
                  <strong class="userinput"><code>YES</code></strong> (the default
                  behavior), this method starts searching in reserved
                  accessors (ones starting with underscores) first.</p></li></ul></div><p>For example, if <em class="replaceable"><code>key</code></em> is <code class="literal">"field"</code>, and <code class="literal">+useStoredAccessor</code> returns <strong class="userinput"><code>YES</code></strong>, <code class="literal">-storedValueForKey</code>: tries the
              following ways to get the associated value:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Calls <code class="literal">-_getField</code>,
                  if it exists.</p></li><li class="listitem"><p>Calls <code class="literal">-_field</code>, if
                  it exists.</p></li><li class="listitem"><p>Reads <code class="literal">_field</code>, if it
                  exists and direct access is allowed.</p></li><li class="listitem"><p>Reads <code class="literal">field</code>, if it
                  exists and direct access is allowed.</p></li><li class="listitem"><p>Calls <code class="literal">-getField</code>, if
                  it exists.</p></li><li class="listitem"><p>Calls <code class="literal">-field</code>, if it
                  exists.</p></li></ol></div><p>If all of these fail, <code class="literal">-storedValueForKey</code>: calls <code class="literal">-handleQueryWithUnboundKey</code>: on your
              instance.</p><p>The alternative search sequence supported by <code class="literal">-storedValueForKey</code>: facilitates using
              key-value coding for storing and retrieving objects from a
              database, when you want to bypass public accessors that may have
              side-effects.</p></dd><dt><span class="term"><code class="code"><a id="I_1_tt156"/>-(<strong class="userinput"><code>void</code></strong>)takeStoredValue:(<strong class="userinput"><code>id</code></strong>)<em class="replaceable"><code>value</code></em>
            forKey:(NSString*)<em class="replaceable"><code>key</code></em> </code></span></dt><dd><p><a id="IXT-1-517" class="indexterm"/>Works like <code class="literal">-takeValue:forKey</code>:, but with a
              possibly different search sequence:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If <code class="literal">-useStoredAccessor</code> return
                  <strong class="userinput"><code>NO</code></strong>, the sequence is
                  the same.</p></li><li class="listitem"><p>If <code class="literal">+useStoredAccessor</code> returns
                  <strong class="userinput"><code>YES</code></strong> (the default
                  behavior), this method starts searching in reserved
                  accessors (ones starting with underscore) first.</p></li></ul></div><p>For example, if the key is <code class="literal">field</code>, and <code class="literal">+useStoredAccessor</code> returns <strong class="userinput"><code>YES</code></strong>, <code class="literal">-takeStoredValue:forKey</code>: tries the
              following ways to get the associated value:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Calls <code class="literal">-_setField</code>:,
                  if it exists.</p></li><li class="listitem"><p>Sets <code class="literal">_field</code>, if it
                  exists and direct access is allowed.</p></li><li class="listitem"><p>Sets <code class="literal">field</code>, if it
                  exists and direct access is allowed.</p></li><li class="listitem"><p>Calls <code class="literal">-setField</code>:,
                  if it exists.</p></li></ol></div><p>If all of these fail, <code class="literal">-takeStoredValue:forKey</code>: calls
              <code class="literal">-handleTakeValue:forUnboundKey</code>: on
              your object.</p></dd><dt><span class="term"><code class="code"><a id="I_1_tt157"/>+(<strong class="userinput"><code>BOOL</code></strong>)accessInstanceVariablesDirectly</code></span></dt><dd><p><a id="IXT-1-518" class="indexterm"/>The <code class="literal">NSObject</code>
              version returns <strong class="userinput"><code>YES</code></strong>.
              Override this in your class to affect the search sequence for
              the basic methods <code class="literal">-valueForKey</code>: and <code class="literal">-takeValueForKey</code>:.</p></dd><dt><span class="term"><code class="code"><a id="I_1_tt158"/>+(<strong class="userinput"><code>BOOL</code></strong>)useStoredAccessor</code></span></dt><dd><p><a id="IXT-1-519" class="indexterm"/>The <code class="literal">NSObject</code>
              version returns <strong class="userinput"><code>YES</code></strong>.
              Override this in your class to affect the search sequence for
              the stored methods <code class="literal">-storedValueForKey</code>: <a id="IXTR3-638" class="indexterm"/>and <code class="literal">-takeStoredValue:forKey</code>:.</p></dd></dl></div></div><div class="sect2" title="Handling Key Lookup Failures"><div class="titlepage"><div><div><h2 class="title"><a id="objectcpr-CHP-1-SECT-14.3"/>Handling Key Lookup Failures</h2></div></div></div><p>The category <code class="literal">NSKeyValueCodingExceptions</code> <a id="IXT-1-520" class="indexterm"/> provides three methods for handling failures in the
        lookup sequence and other problems:</p><div class="variablelist"><dl><dt><span class="term"><code class="code"><a id="I_1_tt159"/>-(<strong class="userinput"><code>id</code></strong>)handleQueryWithUnboundKey:(NSString*)<em class="replaceable"><code>key</code></em>
            </code></span></dt><dd><p><a id="IXT-1-521" class="indexterm"/>Called when lookup fails for a getter (<code class="literal">-valueForKey</code>: or <code class="literal">-storedValueForKey</code>:) with the provided
              key. The default version of this method, provided in <code class="literal">NSObject</code>, raises an <code class="literal">UnknownKeyException</code> <a id="IXT-1-522" class="indexterm"/>. Override this to handle things your way.</p></dd><dt><span class="term"><code class="code"><a id="I_1_tt160"/>-(<strong class="userinput"><code>void</code></strong>)handleTakeValue:(<strong class="userinput"><code>id</code></strong>)<em class="replaceable"><code>value</code></em>
            forUnboundKey:(NSString*)<em class="replaceable"><code>key</code></em>
            </code></span></dt><dd><p><a id="IXT-1-523" class="indexterm"/>Called when lookup fails for a setter (<code class="literal">-takeValueForKey</code>: or <code class="literal">-takeStoredValueForKey</code>:) with the
              provided key. The default version of this method, provided in
              <code class="literal">NSObject</code>, raises an <code class="literal">UnknownKeyException</code>. Override this to
              handle things your way.</p></dd><dt><span class="term"><code class="code"><a id="I_1_tt161"/>-(<strong class="userinput"><code>void</code></strong>)unableToSetNilForKey:(NSString*)<em class="replaceable"><code>key</code></em>
            </code></span></dt><dd><p><a id="IXT-1-524" class="indexterm"/>Called when you pass <strong class="userinput"><code>nil</code></strong> in to a setter for a numeric
              field. <code class="literal">NSObject</code>'s version
              raises an exception. Override this in your class if there is a
              plausible numeric value (zero, or an out-of-band value)
              <a id="IXTR3-639" class="indexterm"/>to <a id="IXTR3-640" class="indexterm"/> <a id="IXTR3-641" class="indexterm"/>use.</p></dd></dl></div></div></div></body></html>
